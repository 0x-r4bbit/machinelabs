<div fxLayout="column" style="height: 100%;">
  <md-toolbar color="primary" class="ml-toolbar">
    <div fxLayout fxLayoutAlign="space-between center" fxFlex class="padded">
      <span class="ml-logo">Machine<span>Labs</span></span>

      <div fxFlex class="ml-toolbar__lab-name">
        <md-input-container>
          <input mdInput [readOnly]="true" [(ngModel)]="lab.name">
        </md-input-container>
        <button md-icon-button><md-icon>edit</md-icon></button>
      </div>

      <div fxLayout fxLayoutAlign="end">
        <div fxLayout class="ml-toolbar__cta-bar">
          <button md-button (click)="run(lab)" *ngIf="!context.isRunning()"><md-icon>cached</md-icon> Run</button>
          <button md-button (click)="stop(context)" *ngIf="context.isRunning()"><md-icon>stop</md-icon> Stop</button>
          <button *ngIf="lab.user_id == user?.uid" md-button (click)="save(lab)"><md-icon>save</md-icon> Save</button>
          <button md-button (click)="fork(lab)"><md-icon>share</md-icon> Fork</button>
          <button md-button (click)="create()"><md-icon>add</md-icon> New</button>
        </div>

        <button md-icon-button [md-menu-trigger-for]="menu">
          <md-icon *ngIf="user?.isAnonymous">more_vert</md-icon>
          <img *ngIf="user && user.photoURL" [src]="user.photoURL" alt="{{user.displayName}} profile picture" class="ml-login-avatar">
        </button>

        <md-menu #menu="mdMenu">
          <button md-menu-item *ngIf="user?.isAnonymous" (click)="loginWithGitHub()"><md-icon>perm_identity</md-icon>Login with GitHub</button>
          <button *ngIf="!user?.isAnonymous" (click)="logout()" md-menu-item><md-icon>exit_to_app</md-icon>Sign Out</button>
        </md-menu>
      </div>
    </div>
  </md-toolbar>
  <md-sidenav-container>
    <md-sidenav opened="true" mode="side" #sidenav class="ml-sidebar">
      <ml-panel panelTitle="Files">
        <ml-file-tree
          [files]="lab.files"
          [selectedFile]="activeFile"
          (selectFile)="openFile($event)"
          (removeFile)="deleteFile($event)"
          (addFile)="openAddFileDialog()"></ml-file-tree>
      </ml-panel>
    </md-sidenav>
    <div role="main" fxLayout>
      <ml-panel [panelTitle]="activeFile.name" fxFlex="50">
        <ml-ace-editor
          #editor
          [(value)]="activeFile.content"
          mode="python"></ml-ace-editor>
      </ml-panel>
      <ml-panel panelTitle="Output" fxFlex="50">
        <ml-ace-editor
          [value]="output | async"
          [readOnly]="true"
          [showGutter]="false"
          mode="sh"></ml-ace-editor>
      </ml-panel>
    </div>
  </md-sidenav-container>
  <div class="ml-footer">
    <div fxLayout="row" fxLayoutAlign="space-between center">
      <md-slide-toggle
        color="accent"
        [checked]="true"
        (click)="sidenav.toggle()">File browser</md-slide-toggle>
      <div class="ml-footer__status">
        <div *ngIf="context.isRunning()">
          <md-progress-bar
            color="accent"
            [bufferValue]="0"
            mode="indeterminate"></md-progress-bar>
        </div>
      </div>
      <div>
        <button disabled md-button md-raised-button md-primary class="elevated">Share</button>
        <button disabled md-button md-raised-button md-primary class="elevated">Embed</button>
      </div>
    </div>
  </div>
</div>
